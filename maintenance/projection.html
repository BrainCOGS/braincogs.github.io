<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Projection | BRAIN CoGS mini VR rigs</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Documentation for virtual reality rigs at Princeton BRAIN CoGS project">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.6e54da3e.css" as="style"><link rel="preload" href="/assets/js/app.2e1d0086.js" as="script"><link rel="preload" href="/assets/js/2.f73e3e1e.js" as="script"><link rel="preload" href="/assets/js/1.c51b9512.js" as="script"><link rel="preload" href="/assets/js/39.dd78eec6.js" as="script"><link rel="prefetch" href="/assets/js/10.28ab9cf5.js"><link rel="prefetch" href="/assets/js/11.b8e01274.js"><link rel="prefetch" href="/assets/js/12.01f9d7cf.js"><link rel="prefetch" href="/assets/js/13.3e4bb9d9.js"><link rel="prefetch" href="/assets/js/14.4280d58e.js"><link rel="prefetch" href="/assets/js/15.c2481de1.js"><link rel="prefetch" href="/assets/js/16.0d27a42c.js"><link rel="prefetch" href="/assets/js/17.bf76a0f7.js"><link rel="prefetch" href="/assets/js/18.219da49e.js"><link rel="prefetch" href="/assets/js/19.8e1d46db.js"><link rel="prefetch" href="/assets/js/20.aa1d6fa3.js"><link rel="prefetch" href="/assets/js/21.1931c23e.js"><link rel="prefetch" href="/assets/js/22.796e9949.js"><link rel="prefetch" href="/assets/js/23.cc03e5ad.js"><link rel="prefetch" href="/assets/js/24.f1842dd7.js"><link rel="prefetch" href="/assets/js/25.1cc0ff2e.js"><link rel="prefetch" href="/assets/js/26.bf610798.js"><link rel="prefetch" href="/assets/js/27.34d9178c.js"><link rel="prefetch" href="/assets/js/28.27e8c12c.js"><link rel="prefetch" href="/assets/js/29.13b12301.js"><link rel="prefetch" href="/assets/js/3.e8951f3a.js"><link rel="prefetch" href="/assets/js/30.75a380a5.js"><link rel="prefetch" href="/assets/js/31.e245e83a.js"><link rel="prefetch" href="/assets/js/32.9fca9676.js"><link rel="prefetch" href="/assets/js/33.0e3bba28.js"><link rel="prefetch" href="/assets/js/34.220cdeed.js"><link rel="prefetch" href="/assets/js/35.ecdec2a2.js"><link rel="prefetch" href="/assets/js/36.758a67d9.js"><link rel="prefetch" href="/assets/js/37.f2b19388.js"><link rel="prefetch" href="/assets/js/38.ddeff521.js"><link rel="prefetch" href="/assets/js/4.8d93e77a.js"><link rel="prefetch" href="/assets/js/40.080bf08b.js"><link rel="prefetch" href="/assets/js/41.b5e0bbd1.js"><link rel="prefetch" href="/assets/js/42.8fd55afd.js"><link rel="prefetch" href="/assets/js/43.836fbed0.js"><link rel="prefetch" href="/assets/js/44.7558313c.js"><link rel="prefetch" href="/assets/js/45.98c02387.js"><link rel="prefetch" href="/assets/js/46.f7863950.js"><link rel="prefetch" href="/assets/js/47.58ee2c27.js"><link rel="prefetch" href="/assets/js/48.baf53650.js"><link rel="prefetch" href="/assets/js/49.5a74915a.js"><link rel="prefetch" href="/assets/js/5.6ffcefef.js"><link rel="prefetch" href="/assets/js/50.557a1eb8.js"><link rel="prefetch" href="/assets/js/51.6351139d.js"><link rel="prefetch" href="/assets/js/52.9cb0c7c8.js"><link rel="prefetch" href="/assets/js/6.f914edf2.js"><link rel="prefetch" href="/assets/js/7.ea5c102c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d116d088.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6e54da3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">BRAIN CoGS mini VR rigs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/building/" class="nav-link">
  Building
</a></div><div class="nav-item"><a href="/maintenance/" class="nav-link router-link-active">
  Maintenance
</a></div><div class="nav-item"><a href="/software/" class="nav-link">
  Software
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/building/" class="nav-link">
  Building
</a></div><div class="nav-item"><a href="/maintenance/" class="nav-link router-link-active">
  Maintenance
</a></div><div class="nav-item"><a href="/software/" class="nav-link">
  Software
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/maintenance/" aria-current="page" class="sidebar-link">Maintenance of a mini VR rig</a></li><li><a href="/maintenance/projection.html" aria-current="page" class="active sidebar-link">Projection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/maintenance/projection.html#projection-calibration" class="sidebar-link">Projection calibration</a></li><li class="sidebar-sub-header"><a href="/maintenance/projection.html#projector-bulb-replacement" class="sidebar-link">Projector bulb replacement.</a></li></ul></li><li><a href="/maintenance/reward.html" class="sidebar-link">Reward</a></li><li><a href="/maintenance/stage.html" class="sidebar-link">Stage</a></li><li><a href="/maintenance/positioning.html" class="sidebar-link">Positioning</a></li><li><a href="/maintenance/miscellaneous.html" class="sidebar-link">Miscellaneous</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> Projection</h1> <p>The projection module maintenance consist primarily on the initial calibration and subsequent maintenance calibrations that should be performed every ~6 months, and the projector bulb replacement that must be done whenever the projector ask for it, since the projector has an internal counter of how many hours the bulb has been used.</p> <h2 id="projection-calibration"><a href="#projection-calibration" class="header-anchor">#</a> Projection calibration</h2> <p>The projection system use a spherical mirror to project into the dome. The image transformation is based on a <a href="http://www.domerama.com/general/geodesic-dome-projection/hemispherical-dome-projection/" target="_blank" rel="noopener noreferrer">hemispherical dome projection principle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Creating correctly warped images given a particular projector, mirror, and dome arrangement requires finding the point on the projector frustum for any point on the dome. The problem is three-dimensional but can be turned into a simpler two dimensional problem by firstly translating the geometry so the spherical mirror is at the origin and then rotating the geometry so that the point on the mirror, dome, and projector lies in a single plane.</p> <p>The projector is located at P1, the mirror is of radius r, and the position on the dome is P2. The path length from the projector to the mirror is L1, the path length from the dome to the mirror is L2. In the case of a spherical mirror: the line at mid-angle between the vectors OP1 and OP2 and its intersection with the surface of the mirror defines the reflection point.</p> <p>Fermat’s principle states that light travels by the shortest route, so the reflection point on the mirror can be found by minimising the total light path length from the projector to the position on the dome, namely minimising (L1^2 + L2^2)^1/2. It is quite simple in the case of a spherical mirror: the line at mid-angle between the vectors OP1 and OP2 and its intersection with the surface of the mirror defines the reflection point.</p> <figure><img src="/assets/img/projection-1.8e1de7a7.png"></figure> <p>The projection calibration will align the projection within certain boundaries, specifically the horizon, the center and the left and right side will be aligned to the physical position of the dome. This method has a trade-off in the time that has to be inverted to perform the alignment vs the accuracy of the rendered projection, since the height of the towers might be different across systems.</p> <p>To calibrate the projection:</p> <ol><li>Turn on the projector and make sure to mirror the projection horizontally, otherwise left/right will be inverted.</li> <li>Place the alignment tool. We recommend to use a <a href="https://www.grainger.com/product/BOSCH-Alignment-Laser-3-Beams-450W78?internalSearchTerm=Alignment+Laser%3A+3+Beams%2C+0+Dots%2C+0+Lines%2C+Red%2C+200+ft+Range+w%2Fo+Detector&amp;suggestConfigId=8&amp;searchBar=true&amp;opr=THKS" target="_blank" rel="noopener noreferrer">3 laser alignment tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Use the marked lines at the bottom plate to align the center and sides lasers on the dome. Set the height of the horizontal laser to 12&quot; from the bottom plate.</li> <li>Create a new subject in the ViRMEn training GUI and select the livecalibration.mat experiment. This is the calibration world that was developed, it is necessary to set the simulation mode to true in the RigParameters file. This will project a static world with 3 towers set at the center and at the left and right of the mouse eyes. The goal is to align the horizon to the animal eyes position, the center tower to the center of the screen and the left and right towers to the mouse eyes position.</li> <li>Set the initial vairables of the projection parameters as below (these parameters has been obatained empirically and they are a good starting point for the training mini VR rigs as they are built).</li></ol> <div class="language- extra-class"><pre class="language-text"><code>%% Mini VR projection parameters
% Spherical screen radius
proj_param_Rs           =    8;

% Screen's center location relative to the animal eyes
proj_param_xsm          =    1.814;
proj_param_ysm          =    0;
proj_param_zsm          =    0.47;

% Mirror position relative to the animal eyes
% Mirror position measurement is facilitated knowing that the center of 
%spherical mirror is (43.8-24.2=)19.6mm (0.77in) behind the back surface.
proj_param_xOm          =   5.582;
proj_param_yOm          =   0;
proj_param_zOm          =   -6.62;

% Radius of the spherical mirror (Silver coated lens LA1740-Thorlabs)
proj_param_r            =   1.724;

% Projector position relative to the mirror center
proj_param_xP1o         =   11.1;
proj_param_yP1o         =   0;
proj_param_zP1o         =   -0.6;

% Horizontal coordinate shift and rescaling
proj_param_hrescaling   =   5.5;
proj_param_hshift       =   0.000;

% Vertical coordinate shift and rescaling
proj_param_vrescaling   =   5.5;
proj_param_vshift       =   -1.017;


</code></pre></div><ol start="4"><li>First, try to align certain variables by physically moving the projector. Unscrew the plate that holds the projector and move it horizontally until the middle tower is centered with the laser. Make sure that the left and rigth towers are equidistant from the middle of the dome, you may be able to achieve this by slightly moving the plate forward from one side or the other.</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The position of the towers will move when the plate is thightened, don't untight the screws all the way if it is not necessary, unthight until it is possible to move the plate and checking the projection, then thight and adjust accordingly.</p></div> <p>The goal of doing this physically instead of modifying the projection transformation parameters is that it decreases the differences across the projections in different training rigs.</p> <ol start="5"><li>Adjust the rest of the parameters until the towers and horizon are aligned. A brief description of how each parameter adjust the projection can be found below.</li></ol> <ul><li><strong>Rs</strong> should not be modified.</li> <li><strong>xsm</strong> will adjust the middle tower height without affecting the lateral towers, values should be around [1.5 - 2]. This value canbe adjusted since there will be idiosincrasies due to the screen fabrication.</li> <li><strong>zOm</strong> will adjust the horizon. This value can be adjusted since there can be differences in how the mirror is glued to its aluminum base.</li> <li><strong>xP1o</strong> will extend or contract the lateral towers and <strong>zP1o</strong> will lower or elevate the middle tower but will modify the distal part of the lateral towers. These values can be adjusted since there are idiosincrasies in the origin of the projection between projectors in their fabrication.</li> <li>The <strong>hrescaling</strong> and the <strong>vrescaling</strong> should be the same, otherwise it will modify elongate or contract the projection, and there will be significant differences across sytems.</li> <li>The <strong>hshift</strong> and <strong>vshift</strong> will move the entire projection up, down, left or right. Ideally the <strong>hshift</strong> should be 0 if the projection is calibrated manually, but it can be modified if necessary since it shouldn't affect significatly the projection across differente systems.</li></ul> <figure><img src="/assets/img/projection-2.e4e10713.png"> <center><figcaption><small>Projection calibration. Due to the principle of the spherical mirror projection, the lateral towers will be slightly curved, the projection should be fine as long as they are equidistant and centered at the top (or the bottom, just make sure to keep the same policy across rigs).</small></figcaption></center></figure> <h2 id="projector-bulb-replacement"><a href="#projector-bulb-replacement" class="header-anchor">#</a> Projector bulb replacement.</h2> <p>The projector has a counter used to determine how long the bulb has been used, it will emit an alert that the bulb should be replaced. Make sure to have in stock projector bulbs and follow each projector instruction to replace it.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/maintenance/" class="prev router-link-active">
        Maintenance of a mini VR rig
      </a></span> <span class="next"><a href="/maintenance/reward.html">
        Reward
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.2e1d0086.js" defer></script><script src="/assets/js/2.f73e3e1e.js" defer></script><script src="/assets/js/1.c51b9512.js" defer></script><script src="/assets/js/39.dd78eec6.js" defer></script>
  </body>
</html>
